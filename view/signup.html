<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="bullion management site, rare coins, gold, silver, platinum">
    <meta name="author" content="CSE134B Dream Team">
    <title>Sign Up For Bull's Hit</title>
    <link rel="stylesheet" type="text/css" href="../style/style.css">
    <meta name=viewport content="width=device-width, initial-scale=.8, minimum-scale = .8, user-scalable=yes">
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link data-require="purecss@*" data-semver="0.6.0" rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css" />
    <script src="../js/jquery-1.11.2.min.js"></script>
    <script src="../js/velocity.min.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/component/cookies.min.js"></script>
</head>

<body>
    <nav>
        Bull's Hit
    </nav>
    <div class="mobile-nav">
        Bull's Hit
    </div>

    <div id="w0-wrapper">
        <form class="pure-form pure-form-stacked reg">
            <fieldset>
                <legend>Sign Up</legend>
                <label for="username">Username</label>
                <input class="reg" id="username" name="username" type="text" placeholder="Username" required/>

                <label for="email">Email</label>
                <input class="reg" id="email" name="email" type="email" placeholder="Email" required/>

                <label for="password">Password</label>
                <input class="reg" id="password" name="password" type="password" placeholder="Password" required/>

                <button id="submitButton" type="button" class="pure-button pure-button-primary">Register</button>

                <div id="alert-box">
                    Please enter your user information.
                </div>
            </fieldset>
        </form>
    </div>
    <script>
        window.onload = function() {
            function reqListener() {
                console.log(this.responseText);
            }

            var appId = "iFY8hb8r6Ue1Qh98NBCP1tWshhexxQS1tOsRTk0W";
            var apiKey = "xPKaGBUFnH5vhMN8W77wuuGFoeesi4zbl0H2bLL1";

            document.getElementById("submitButton")
                .addEventListener("click", function() {
                    var username = document.getElementById('username').value;
                    var email = document.getElementById('email').value;
                    var password = document.getElementById('password').value;
                    var encodedString = encodeURI('username=' + username + '&password=' + password);
                    console.log(encodedString);

                    var bodyData = {
                        'username': username,
                        'password': password,
                        'email': email
                    }

                    var req = new XMLHttpRequest();
                    req.onreadystatechange = function(oEvent) {
                        if (req.readyState === 4) {
                            if (req.status === 201) {           // CASE SUCCESS
                                // Parse the string into a JSON obj
                                var tmpObj = JSON.parse(req.responseText);
                                console.log('Success');
                                console.log(tmpObj.results);
                                cookie.set('sessionToken', tmpObj.sessionToken);
                                console.log(cookie.get('sessionToken'));
                                window.location.href = "wire2.html";
                            } else {                            // CASE ERROR
                                console.log("Error: ", req.statusText);
                                var errorMessage = "";
                                if (username === "")
                                    errorMessage = errorMessage + "Username is required!<br>";
                                if (email === "")
                                    errorMessage = errorMessage + "Email is required!<br>";
                                if (password === "")
                                    errorMessage = errorMessage + "Password is required!<br>";
                                document.getElementById('alert-box').style.color = "RED";
                                document.getElementById('alert-box').innerHTML = errorMessage;
                            }
                        }
                    };
                    req.open("POST", " https://api.parse.com/1/users", true);
                    req.setRequestHeader("X-Parse-Application-Id", appId);
                    req.setRequestHeader("X-Parse-REST-API-Key", apiKey);
                    req.setRequestHeader("Content-Type", 'application/json');
                    req.send(JSON.stringify(bodyData));
                });
        }

         // Using the 1kb Promise.js Utility Library for Promises and AJAX
        /*function(){

            promise.get('https://api.parse.com/1/login', encodedString, {
                        "Accept": "application/json",
                        "X-Parse-Application-Id": "iFY8hb8r6Ue1Qh98NBCP1tWshhexxQS1tOsRTk0W",
                        "X-Parse-REST-API-Key": "xPKaGBUFnH5vhMN8W77wuuGFoeesi4zbl0H2bLL1"
                    }).then(function(error, text, xhr) {
                        if (error) {
                            console.log('Error ' + xhr.status);
                            return;
                        }
                        var tmpObj = JSON.parse(text);
                        //Cookies another 1kb
                        console.log(tmpObj);
                        Cookies.set('sessionToken', tmpObj.sessionToken);
                        console.log(Cookie.get('sessionToken'));
                    });
        }*/
    </script>
    <script>loadFooter();</script>
</body>

</html>
